<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gemini 3 Pro Image ã‚³ã‚¹ãƒˆè¨ˆç®—æ©Ÿ</title>
    <!-- Vue.js 3 -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f8f9fa; padding-top: 20px; padding-bottom: 40px; }
        .card { box-shadow: 0 4px 6px rgba(0,0,0,0.1); border: none; margin-bottom: 20px; }
        .result-card { transition: transform 0.2s; border: 2px solid transparent; }
        .result-card.winner { border-color: #198754; background-color: #f0fff4; transform: scale(1.02); }
        .price-display { font-size: 1.5rem; font-weight: bold; color: #333; }
        .winner .price-display { color: #198754; }
        .slider-label { display: flex; justify-content: space-between; font-weight: 500; font-size: 0.9rem; }
        .badge-custom { font-size: 0.8em; }
        .details-list { font-size: 0.85rem; color: #666; list-style: none; padding-left: 0; margin-top: 10px; }
        .details-list li { display: flex; justify-content: space-between; border-bottom: 1px dashed #eee; padding: 4px 0; }
        .invalid-cache { opacity: 0.6; filter: grayscale(1); }
    </style>
</head>
<body>
    <div id="app" class="container">
        <div class="row mb-4">
            <div class="col-12 text-center">
                <h1 class="h3">ğŸŒ Nano Banana Pro Preview ã‚³ã‚¹ãƒˆè¨ˆç®—æ©Ÿ</h1>
                <p class="text-muted small">Vertex AI / 2025å¹´ è©¦ç®—ãƒ¬ãƒ¼ãƒˆ</p>
            </div>
        </div>

        <div class="row">
            <!-- å…¥åŠ›ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ -->
            <div class="col-lg-5">
                <div class="card p-3">
                    <h5 class="card-title mb-3">ğŸ› ï¸ ãƒªã‚¯ã‚¨ã‚¹ãƒˆè¨­å®š</h5>

                    <!-- å…¥åŠ›ç”»åƒ -->
                    <div class="mb-3">
                        <div class="slider-label">
                            <span>å…¥åŠ›ç”»åƒæšæ•° (560t/æš)</span>
                            <span class="badge bg-primary">{{ inputImages }} æš</span>
                        </div>
                        <input type="range" class="form-range" min="0" max="50" v-model.number="inputImages">
                    </div>

                    <!-- å…¥åŠ›ãƒ†ã‚­ã‚¹ãƒˆ -->
                    <div class="mb-3">
                        <div class="slider-label">
                            <span>å…¥åŠ›ãƒ†ã‚­ã‚¹ãƒˆ (ãƒˆãƒ¼ã‚¯ãƒ³)</span>
                            <span class="badge bg-primary">{{ formatNumber(inputTextTokens) }} t</span>
                        </div>
                        <input type="range" class="form-range" min="0" max="300000" step="100" v-model.number="inputTextTokens">
                        <div class="input-group input-group-sm mt-1">
                            <input type="number" class="form-control" v-model.number="inputTextTokens">
                        </div>
                    </div>

                    <hr>

                    <!-- å‡ºåŠ›: æ€è€ƒãƒ†ã‚­ã‚¹ãƒˆ -->
                    <div class="mb-3">
                        <div class="slider-label">
                            <span>æ€è€ƒãƒ†ã‚­ã‚¹ãƒˆ (ãƒˆãƒ¼ã‚¯ãƒ³)</span>
                            <span class="badge bg-info text-dark">{{ formatNumber(thinkingTokens) }} t</span>
                        </div>
                        <input type="range" class="form-range" min="0" max="32000" step="100" v-model.number="thinkingTokens">
                    </div>

                    <!-- å‡ºåŠ›: ç”»åƒç”Ÿæˆ -->
                    <div class="mb-3">
                        <div class="slider-label">
                            <span>å‡ºåŠ›ç”»åƒæšæ•°</span>
                            <span class="badge bg-info text-dark">{{ outputImages }} æš</span>
                        </div>
                        <input type="range" class="form-range" min="0" max="4" v-model.number="outputImages">
                    </div>

                    <div class="mb-3" v-if="outputImages > 0">
                        <label class="form-label small">å‡ºåŠ›ç”»è³ª</label>
                        <div class="btn-group w-100" role="group">
                            <input type="radio" class="btn-check" name="quality" id="q_std" value="standard" v-model="outputQuality">
                            <label class="btn btn-outline-secondary btn-sm" for="q_std">æ¨™æº– (1024px)</label>
                            
                            <input type="radio" class="btn-check" name="quality" id="q_high" value="high" v-model="outputQuality">
                            <label class="btn btn-outline-secondary btn-sm" for="q_high">é«˜ç”»è³ª (4096px)</label>
                        </div>
                    </div>

                    <!-- å‡ºåŠ›: ãƒ†ã‚­ã‚¹ãƒˆ -->
                    <div class="mb-3">
                        <div class="slider-label">
                            <span>å‡ºåŠ›ãƒ†ã‚­ã‚¹ãƒˆ (ãƒˆãƒ¼ã‚¯ãƒ³)</span>
                            <span class="badge bg-info text-dark">{{ formatNumber(outputTextTokens) }} t</span>
                        </div>
                        <input type="range" class="form-range" min="0" max="8192" step="50" v-model.number="outputTextTokens">
                    </div>

                    <hr>
                    
                    <!-- ã‚­ãƒ£ãƒƒã‚·ãƒ¥å‰ææ¡ä»¶ -->
                    <div class="mb-3 bg-light p-2 rounded">
                        <h6 class="small fw-bold">ã‚­ãƒ£ãƒƒã‚·ãƒ¥è©¦ç®—ã®å‰æ</h6>
                        <div class="mb-2">
                            <div class="slider-label">
                                <span class="small">ã“ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’1æ™‚é–“ã‚ãŸã‚Šä½•å›ä½¿ã†ï¼Ÿ</span>
                                <span class="badge bg-secondary">{{ cacheReuseCount }} å›</span>
                            </div>
                            <input type="range" class="form-range" min="1" max="1000" v-model.number="cacheReuseCount">
                            <div class="form-text small" style="font-size: 0.75rem;">
                                ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸è²»ç”¨($4.50/1M/h)ã‚’åˆ©ç”¨å›æ•°ã§å‰²ã£ã¦åŠ ç®—ã—ã¾ã™ã€‚
                            </div>
                        </div>
                    </div>

                </div>
            </div>

            <!-- è¨ˆç®—çµæœ -->
            <div class="col-lg-7">
                <div class="card p-3 mb-3 bg-white">
                    <h5 class="card-title">ğŸ“Š ãƒˆãƒ¼ã‚¯ãƒ³é›†è¨ˆ & ãƒ¬ãƒ¼ãƒˆåˆ¤å®š</h5>
                    <div class="row text-center mt-2">
                        <div class="col-4 border-end">
                            <small class="text-muted">ç·å…¥åŠ›ãƒˆãƒ¼ã‚¯ãƒ³</small>
                            <div class="fw-bold">{{ formatNumber(totalInputTokens) }}</div>
                        </div>
                        <div class="col-4 border-end">
                            <small class="text-muted">é©ç”¨ãƒ¬ãƒ¼ãƒˆå¸¯</small>
                            <div :class="{'text-danger': isHighTier, 'text-success': !isHighTier}" class="fw-bold">
                                {{ isHighTier ? '> 200k' : 'â‰¤ 200k' }}
                            </div>
                        </div>
                        <div class="col-4">
                            <small class="text-muted">ç·å‡ºåŠ›ãƒˆãƒ¼ã‚¯ãƒ³(Text+Think)</small>
                            <div class="fw-bold">{{ formatNumber(totalOutputTextTokens) }}</div>
                        </div>
                    </div>
                </div>

                <!-- æ¯”è¼ƒçµæœ -->
                <div class="row">
                    <!-- æ¨™æº–å…¥åŠ› -->
                    <div class="col-md-4">
                        <div class="card p-3 result-card" :class="{ 'winner': bestOption === 'standard' }">
                            <h6 class="text-center fw-bold">æ¨™æº–å…¥åŠ›</h6>
                            <div class="text-center price-display">${{ formatPrice(costs.standard.total) }}</div>
                            <div class="text-center small text-muted mb-2">/ 1ãƒªã‚¯ã‚¨ã‚¹ãƒˆ</div>
                            <ul class="details-list">
                                <li><span>å…¥åŠ›</span> <span>${{ formatPrice(costs.standard.input) }}</span></li>
                                <li><span>å‡ºåŠ›(Text)</span> <span>${{ formatPrice(costs.standard.outputText) }}</span></li>
                                <li><span>å‡ºåŠ›(Img)</span> <span>${{ formatPrice(costs.standard.outputImg) }}</span></li>
                            </ul>
                        </div>
                    </div>

                    <!-- ãƒãƒƒãƒå…¥åŠ› -->
                    <div class="col-md-4">
                        <div class="card p-3 result-card" :class="{ 'winner': bestOption === 'batch' }">
                            <h6 class="text-center fw-bold">ãƒãƒƒãƒå…¥åŠ›</h6>
                            <div class="text-center price-display">${{ formatPrice(costs.batch.total) }}</div>
                            <div class="text-center small text-muted mb-2">50% OFF</div>
                            <ul class="details-list">
                                <li><span>å…¥åŠ›</span> <span>${{ formatPrice(costs.batch.input) }}</span></li>
                                <li><span>å‡ºåŠ›(Text)</span> <span>${{ formatPrice(costs.batch.outputText) }}</span></li>
                                <li><span>å‡ºåŠ›(Img)</span> <span>${{ formatPrice(costs.batch.outputImg) }}</span></li>
                            </ul>
                        </div>
                    </div>

                    <!-- ã‚­ãƒ£ãƒƒã‚·ãƒ¥å…¥åŠ› -->
                    <div class="col-md-4">
                        <div class="card p-3 result-card" :class="{ 'winner': bestOption === 'cache', 'invalid-cache': !canUseCache }">
                            <h6 class="text-center fw-bold">
                                ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚­ãƒ£ãƒƒã‚·ãƒ¥
                                <span v-if="!canUseCache" class="badge bg-danger rounded-pill" style="font-size:0.6rem; vertical-align: top;">ä¸å¯</span>
                            </h6>
                            <div v-if="canUseCache">
                                <div class="text-center price-display">${{ formatPrice(costs.cache.total) }}</div>
                                <div class="text-center small text-muted mb-2">å…¥åŠ›90%OFF + ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸</div>
                                <ul class="details-list">
                                    <li><span>å…¥åŠ›(Cached)</span> <span>${{ formatPrice(costs.cache.input) }}</span></li>
                                    <li><span>å‡ºåŠ›(Total)</span> <span>${{ formatPrice(costs.cache.outputTotal) }}</span></li>
                                    <li><span>ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸</span> <span>${{ formatPrice(costs.cache.storage) }}</span></li>
                                </ul>
                            </div>
                            <div v-else class="text-center text-danger mt-3 mb-3 small">
                                <br>å…¥åŠ›ãƒˆãƒ¼ã‚¯ãƒ³ãŒ<br>32,000æœªæº€ã®ãŸã‚<br>åˆ©ç”¨ã§ãã¾ã›ã‚“
                            </div>
                        </div>
                    </div>
                </div>

                <div class="alert alert-info small">
                    <strong>ğŸ’¡ æœ€ã‚‚å®‰ããªã‚‹æ–¹æ³•:</strong> 
                    <span v-if="bestOption === 'standard'">æ¨™æº–å…¥åŠ› (ãƒãƒƒãƒ/ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®ãƒ¡ãƒªãƒƒãƒˆãªã—)</span>
                    <span v-if="bestOption === 'batch'">ãƒãƒƒãƒå…¥åŠ› (éåŒæœŸå‡¦ç†ãŒå¯èƒ½ãªã‚‰æ¨å¥¨)</span>
                    <span v-if="bestOption === 'cache'">ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚­ãƒ£ãƒƒã‚·ãƒ¥ (1æ™‚é–“ã‚ãŸã‚Š{{ cacheReuseCount }}å›ä»¥ä¸Šãƒªã‚¯ã‚¨ã‚¹ãƒˆã™ã‚‹å ´åˆ)</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    // å…¥åŠ›ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
                    inputImages: 1,
                    inputTextTokens: 1000,
                    thinkingTokens: 0,
                    outputImages: 0,
                    outputQuality: 'standard', // 'standard' or 'high'
                    outputTextTokens: 500,
                    
                    // ã‚­ãƒ£ãƒƒã‚·ãƒ¥è¨ˆç®—ç”¨ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
                    cacheReuseCount: 10, // 1æ™‚é–“ã‚ãŸã‚Šã®å†åˆ©ç”¨å›æ•°
                }
            },
            computed: {
                // ãƒˆãƒ¼ã‚¯ãƒ³è¨ˆç®—
                inputImageTokens() {
                    return this.inputImages * 560;
                },
                totalInputTokens() {
                    return this.inputImageTokens + this.inputTextTokens;
                },
                totalOutputTextTokens() {
                    return this.thinkingTokens + this.outputTextTokens;
                },
                outputImageTokensPerImage() {
                    return this.outputQuality === 'standard' ? 1120 : 2000;
                },
                totalOutputImageGenTokens() {
                    // ç”»åƒç”Ÿæˆãƒˆãƒ¼ã‚¯ãƒ³ã¯ã€Œå‡ºåŠ›ãƒˆãƒ¼ã‚¯ãƒ³ã€ã¨ã—ã¦ã‚«ã‚¦ãƒ³ãƒˆã•ã‚Œã‚‹ãŒå˜ä¾¡ãŒé•ã†
                    return this.outputImages * this.outputImageTokensPerImage;
                },

                // ãƒ¬ãƒ¼ãƒˆåˆ¤å®š
                isHighTier() {
                    return this.totalInputTokens > 200000;
                },
                canUseCache() {
                    return this.totalInputTokens >= 32000;
                },

                // å˜ä¾¡å®šç¾© (å˜ä½: ãƒ‰ãƒ«)
                rates() {
                    // 100ä¸‡ãƒˆãƒ¼ã‚¯ãƒ³ã‚ãŸã‚Šã®å˜ä¾¡
                    const r = {
                        input: this.isHighTier ? 4.00 : 2.00,
                        outputText: this.isHighTier ? 18.00 : 12.00,
                        outputImage: 120.00, // ç”»åƒç”Ÿæˆå°‚ç”¨ãƒ¬ãƒ¼ãƒˆ
                        cacheStorage: 4.50, // per 1M / hour
                    };
                    return r;
                },

                // ã‚³ã‚¹ãƒˆè¨ˆç®—
                costs() {
                    const million = 1000000;
                    
                    // 1. æ¨™æº–ã‚³ã‚¹ãƒˆ
                    const stdInputCost = (this.totalInputTokens / million) * this.rates.input;
                    const stdOutputTextCost = (this.totalOutputTextTokens / million) * this.rates.outputText;
                    const stdOutputImgCost = (this.totalOutputImageGenTokens / million) * this.rates.outputImage;
                    const stdTotal = stdInputCost + stdOutputTextCost + stdOutputImgCost;

                    // 2. ãƒãƒƒãƒã‚³ã‚¹ãƒˆ (å…¨ä½“50% OFF)
                    const batchTotal = stdTotal * 0.5;

                    // 3. ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚³ã‚¹ãƒˆ
                    let cacheTotal = 999999999; // åˆ©ç”¨ä¸å¯æ™‚ã¯é«˜é¡ã«
                    let cacheInputCost = 0;
                    let cacheStorageShare = 0;

                    if (this.canUseCache) {
                        // ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ™‚ã®å…¥åŠ›ã¯æ¨™æº–ã®10%
                        const cachedRate = this.rates.input * 0.10; 
                        cacheInputCost = (this.totalInputTokens / million) * cachedRate;
                        
                        // ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚³ã‚¹ãƒˆ (1æ™‚é–“åˆ†ã®ã‚³ã‚¹ãƒˆã‚’å†åˆ©ç”¨å›æ•°ã§å‰²ã‚‹)
                        // ã‚³ã‚¹ãƒˆ = (ãƒˆãƒ¼ã‚¯ãƒ³ / 1M * $4.50) / ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ•°
                        const hourlyStorage = (this.totalInputTokens / million) * this.rates.cacheStorage;
                        cacheStorageShare = hourlyStorage / this.cacheReuseCount;

                        // å‡ºåŠ›ã‚³ã‚¹ãƒˆã¯æ¨™æº–ã¨åŒã˜
                        cacheTotal = cacheInputCost + stdOutputTextCost + stdOutputImgCost + cacheStorageShare;
                    }

                    return {
                        standard: {
                            total: stdTotal,
                            input: stdInputCost,
                            outputText: stdOutputTextCost,
                            outputImg: stdOutputImgCost
                        },
                        batch: {
                            total: batchTotal,
                            input: stdInputCost * 0.5,
                            outputText: stdOutputTextCost * 0.5,
                            outputImg: stdOutputImgCost * 0.5
                        },
                        cache: {
                            total: cacheTotal,
                            input: cacheInputCost,
                            outputTotal: stdOutputTextCost + stdOutputImgCost,
                            storage: cacheStorageShare
                        }
                    };
                },

                bestOption() {
                    const s = this.costs.standard.total;
                    const b = this.costs.batch.total;
                    const c = this.canUseCache ? this.costs.cache.total : Infinity;

                    if (b < s && b < c) return 'batch';
                    if (c < s && c < b) return 'cache';
                    return 'standard'; // é€šå¸¸ãƒãƒƒãƒãŒä¸€ç•ªå®‰ã„ãŒã€æ¡ä»¶ã«ã‚ˆã£ã¦ã¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒç«¶åˆã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹(ãŸã ã—ãƒãƒƒãƒã‚‚50%OFFãªã®ã§å¼·ã„)
                }
            },
            methods: {
                formatNumber(num) {
                    return new Intl.NumberFormat('ja-JP').format(num);
                },
                formatPrice(num) {
                    // å°æ•°ç‚¹ä»¥ä¸‹6æ¡ã¾ã§è¡¨ç¤ºï¼ˆå¾®å°ãªé‡‘é¡å·®ã‚’è¦‹ã‚‹ãŸã‚ï¼‰
                    if (num === 0) return "0.00";
                    if (num < 0.01) return num.toFixed(5);
                    return num.toFixed(4);
                }
            }
        }).mount('#app');
    </script>
</body>
</html>
